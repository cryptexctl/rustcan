# Архитектура Rustcan

## Обзор системы

Rustcan - это высокопроизводительный сканер портов, построенный на Rust, использующий современные паттерны асинхронного программирования и эффективные техники сетевого сканирования.

## Основные компоненты

### 1. Движок сканирования
- Расположен в `scanner.rs`
- Реализует основную функциональность сканирования
- Использует async/await для параллельного сканирования
- Поддерживает различные паттерны и техники сканирования

### 2. Определение сервисов
- Расположен в `service_detection.rs`
- Реализует определение сервисов
- Использует сопоставление паттернов для идентификации сервисов
- Поддерживает определение множества протоколов

### 3. Сопоставление паттернов
- Расположен в `patterns.rs`
- Определяет паттерны и стратегии сканирования
- Реализует паттерны определения сервисов
- Обрабатывает анализ ответов

### 4. DNS-резолвинг
- Расположен в `dns.rs`
- Обрабатывает разрешение имен хостов
- Использует trust-dns-resolver для асинхронных DNS-запросов
- Поддерживает как IPv4, так и IPv6

### 5. CLI интерфейс
- Расположен в `main.rs`
- Реализует интерфейс командной строки
- Использует clap для парсинга аргументов
- Предоставляет отчеты о прогрессе и форматирование вывода

## Асинхронная среда выполнения

Проект использует Tokio в качестве асинхронной среды выполнения, предоставляя:
- Эффективное планирование задач
- Неблокирующие I/O операции
- Возможности параллельного сканирования
- Управление ресурсами

## Модель параллелизма

- Использует async/await для параллельных операций
- Реализует пулы воркеров для задач сканирования
- Использует каналы для коммуникации между компонентами
- Реализует механизмы обратного давления

## Паттерны сетевого сканирования

1. **TCP Connect Scan**
   - Стандартная попытка TCP-соединения
   - Надежный, но медленнее других методов

2. **Определение сервисов**
   - Специфичные для протокола зонды
   - Сопоставление паттернов ответов
   - Определение версий

3. **DNS-резолвинг**
   - Асинхронное разрешение имен хостов
   - Обратные DNS-запросы
   - Расширение диапазонов IP

## Поток данных

1. Обработка входных данных
   - Аргументы командной строки
   - Спецификация целей
   - Опции сканирования

2. Разрешение целей
   - DNS-резолвинг
   - Расширение диапазонов IP
   - Спецификация портов

3. Процесс сканирования
   - Параллельные попытки соединения
   - Сбор ответов
   - Определение сервисов

4. Генерация вывода
   - Отчеты о прогрессе
   - Форматирование результатов
   - Обработка ошибок

## Обработка ошибок

- Использует anyhow для распространения ошибок
- Реализует пользовательские типы ошибок
- Предоставляет подробные сообщения об ошибках
- Грациозное восстановление после ошибок

## Логирование и мониторинг

- Использует tracing для структурированного логирования
- Реализует отчеты о прогрессе
- Предоставляет подробную статистику сканирования
- Поддерживает различные уровни логирования 